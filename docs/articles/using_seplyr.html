<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using seplyr to Program Over dplyr • seplyr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using seplyr to Program Over dplyr">
<meta property="og:description" content="seplyr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">seplyr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/seplyr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/MutatePartitioner.html">Mutate Partitioner</a>
    </li>
    <li>
      <a href="../articles/named_map_builder.html">Named Map Builder</a>
    </li>
    <li>
      <a href="../articles/rename_se.html">rename_se</a>
    </li>
    <li>
      <a href="../articles/using_seplyr.html">Using seplyr to Program Over dplyr</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://win-vector.com/">Sponsor: Win-Vector LLC</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="using_seplyr_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using seplyr to Program Over dplyr</h1>
                        <h4 class="author">John Mount</h4>
            
            <h4 class="date">2021-08-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/WinVector/seplyr/blob/master/vignettes/using_seplyr.Rmd"><code>vignettes/using_seplyr.Rmd</code></a></small>
      <div class="hidden name"><code>using_seplyr.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p><a href="https://github.com/WinVector/seplyr"><code>seplyr</code></a> is an <a href="https://www.r-project.org"><code>R</code></a> package that makes it easy to program over <a href="https://CRAN.R-project.org/package=dplyr"><code>dplyr</code> <code>0.7.*</code> +</a> without needing to directly use <code>rlang</code> notation.</p>
</div>
<div id="seplyr" class="section level2">
<h2 class="hasAnchor">
<a href="#seplyr" class="anchor"></a><code>seplyr</code>
</h2>
<p><code>seplyr</code> is a <code>dplyr</code> adapter layer that prefers “slightly clunkier” standard interfaces (or <a href="https://en.wikipedia.org/wiki/Referential_transparency">referentially transparent</a> interfaces), which are actually very powerful and can be used to some advantage.</p>
<p>The above description and comparisons can come off as needlessly broad and painfully abstract. Things are much clearer if we move away from theory and return to our example.</p>
<p>Let’s translate the above example into a re-usable function in small (easy) stages. First translate the interactive script from <code>dplyr</code> notation into <code>seplyr</code> notation. This step is a pure <a href="https://en.wikipedia.org/wiki/Code_refactoring">re-factoring</a>, we are changing the code without changing its observable external behavior.</p>
<p>The translation is mechanical in that it is mostly using <code>seplyr</code> documentation as a lookup table. What you have to do is:</p>
<ul>
<li>Change <code>dplyr</code> verbs to their matching <code>seplyr</code> “<code>*_se()</code>” adapters.</li>
<li>Add quote marks around names and expressions.</li>
<li>Convert sequences of expressions (such as in the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>) to explicit vectors by adding the “<code><a href="https://rdrr.io/r/base/c.html">c()</a></code>” notation.</li>
<li>Replace “<code><a href="https://rdrr.io/r/base/assignOps.html">=</a></code>” in expressions with “<code>:=</code>”.</li>
</ul>
<p>Our converted code looks like the following.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org">"dplyr"</a></span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/WinVector/seplyr/">"seplyr"</a></span><span class="op">)</span></code></pre></div>
<pre><code>## Loading required package: wrapr</code></pre>
<pre><code>## 
## Attaching package: 'wrapr'</code></pre>
<pre><code>## The following object is masked from 'package:dplyr':
## 
##     coalesce</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/group_by_se.html">group_by_se</a></span><span class="op">(</span><span class="st">"homeworld"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/summarize_se.html">summarize_se</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mean_height"</span> <span class="op">:=</span> <span class="st">"mean(height, na.rm = TRUE)"</span>,
                 <span class="st">"mean_mass"</span> <span class="op">:=</span> <span class="st">"mean(mass, na.rm = TRUE)"</span>,
                 <span class="st">"count"</span> <span class="op">:=</span> <span class="st">"n()"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 49 x 4
##    homeworld      mean_height mean_mass count
##    &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
##  1 Alderaan              176.      64       3
##  2 Aleen Minor            79       15       1
##  3 Bespin                175       79       1
##  4 Bestine IV            180      110       1
##  5 Cato Neimoidia        191       90       1
##  6 Cerea                 198       82       1
##  7 Champala              196      NaN       1
##  8 Chandrila             150      NaN       1
##  9 Concord Dawn          183       79       1
## 10 Corellia              175       78.5     2
## # … with 39 more rows</code></pre>
<p>This code works the same as the original <code>dplyr</code> code. Also the translation could be performed by following the small set of explicit re-coding rules that we gave above.</p>
<p>Obviously at this point all we have done is: worked to make the code a bit less pleasant looking. We have yet to see any benefit from this conversion (though we can turn this on its head and say all the original <code>dplyr</code> notation is saving us is from having to write a few quote marks).</p>
<p>The benefit is: this new code can <em>very easily</em> be parameterized and wrapped in a re-usable function. In fact it is now simpler to do than to describe.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grouped_mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, 
                         <span class="va">grouping_variables</span>, 
                         <span class="va">value_variables</span>,
                         <span class="va">count_name</span> <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">result_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"mean_"</span>, 
                         <span class="va">value_variables</span><span class="op">)</span>
  <span class="va">expressions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"mean("</span>, 
                        <span class="va">value_variables</span>, 
                        <span class="st">", na.rm = TRUE)"</span><span class="op">)</span>
  <span class="va">calculation</span> <span class="op">&lt;-</span> <span class="va">result_names</span> <span class="op">:=</span> <span class="va">expressions</span>
  <span class="va">data</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/group_by_se.html">group_by_se</a></span><span class="op">(</span><span class="va">grouping_variables</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/summarize_se.html">summarize_se</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">calculation</span>,
                   <span class="va">count_name</span> <span class="op">:=</span> <span class="st">"n()"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">starwars</span> <span class="op">%&gt;%</span> 
  <span class="fu">grouped_mean</span><span class="op">(</span>grouping_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"eye_color"</span>, <span class="st">"skin_color"</span><span class="op">)</span>,
               value_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mass"</span>, <span class="st">"birth_year"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 53 x 5
##    eye_color skin_color       mean_mass mean_birth_year count
##    &lt;chr&gt;     &lt;chr&gt;                &lt;dbl&gt;           &lt;dbl&gt; &lt;int&gt;
##  1 black     green                 80.5            44       2
##  2 black     grey                  78.7           NaN       4
##  3 black     none                 NaN             NaN       1
##  4 black     orange                80              22       1
##  5 black     red, blue, white      57             NaN       1
##  6 black     white, blue          NaN             NaN       1
##  7 blue      blue                 NaN             NaN       1
##  8 blue      brown                136             NaN       1
##  9 blue      dark                  50             NaN       1
## 10 blue      fair                  90              62.6    10
## # … with 43 more rows</code></pre>
<p>We have translated our original interactive or ad-hoc calculation into a parameterized reusable function in two easy steps:</p>
<ul>
<li>Translate into  notation.</li>
<li>Replace values with variables.</li>
</ul>
<p>To be sure: there are some clunky details of using  to build up the expressions, but the conversion process is very regular and easy. In <code>seplyr</code> parametric programming is intentionally easy (just replace values with variables).</p>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>The <code>seplyr</code> methodology is simple, easy to teach, and powerful.</p>
<p>There are alternatives that differ in philosophy.</p>
<ul>
<li>
<code>rlang</code>/tidyeval is often used to build new non-standard interfaces on top of existing non-standard interfaces. This is needed because non-standard interfaces do not naturally compose. The tidy/non-tidy analogy is: it works around a mess by introducing a new mess.</li>
<li>
<code><a href="https://winvector.github.io/wrapr//reference/let.html">wrapr::let()</a></code> converts non-standard interfaces into standard <a href="https://en.wikipedia.org/wiki/Referential_transparency">referentially transparent</a> or value-oriented interfaces. It tries to help clean up messes.</li>
<li>
<code>seplyr</code> is a demonstration of a possible variation of <code>dplyr</code> where more of the interfaces expect values. It tries to cut down on the initial mess, which in turn cuts down on the need for tools and training in dealing with messes.</li>
</ul>
<p>The <code>seplyr</code> package contains a number of worked examples both in <code>help()</code> and <a href="https://winvector.github.io/seplyr/articles/seplyr.html"><code>vignette(package='seplyr')</code></a> documentation.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by John Mount.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
