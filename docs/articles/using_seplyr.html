<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using seplyr to Program Over dplyr • seplyr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using seplyr to Program Over dplyr">
<meta property="og:description" content="seplyr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">seplyr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/seplyr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/MutatePartitioner.html">Mutate Partitioner</a>
    </li>
    <li>
      <a href="../articles/named_map_builder.html">Named Map Builder</a>
    </li>
    <li>
      <a href="../articles/rename_se.html">rename_se</a>
    </li>
    <li>
      <a href="../articles/using_seplyr.html">Using seplyr to Program Over dplyr</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://win-vector.com/">Sponsor: Win-Vector LLC</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="using_seplyr_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using seplyr to Program Over dplyr</h1>
                        <h4 class="author">John Mount</h4>
            
            <h4 class="date">2020-09-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/WinVector/seplyr/blob/master/vignettes/using_seplyr.Rmd"><code>vignettes/using_seplyr.Rmd</code></a></small>
      <div class="hidden name"><code>using_seplyr.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p><a href="https://github.com/WinVector/seplyr"><code>seplyr</code></a> is an <a href="https://www.r-project.org"><code>R</code></a> package that makes it easy to program over <a href="https://CRAN.R-project.org/package=dplyr"><code>dplyr</code> <code>0.7.*</code></a>.</p>
<p>To illustrate this we will work an example.</p>
<p>Suppose you had worked out a <code>dplyr</code> pipeline that performed an analysis you were interested in. For an example we could take something similar to one of the examples from the <a href="https://blog.rstudio.com/2017/06/13/dplyr-0-7-0/"><code>dplyr</code> <code>0.7.0</code> announcement</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="#base/message.html">suppressPackageStartupMessages</a></span>(<span class="fu"><a href="#base/library.html">library</a></span>(<span class="st"><a href="https://dplyr.tidyverse.org">"dplyr"</a></span>))</pre></div>
<pre><code>## Warning: replacing previous import 'vctrs::data_frame' by 'tibble::data_frame'
## when loading 'dplyr'</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="#utils/packageDescription.html">packageVersion</a></span>(<span class="st">"dplyr"</span>)</pre></div>
<pre><code>## [1] '1.0.1'</code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu"><a href="#base/colnames.html">colnames</a></span>(<span class="kw">starwars</span>)</pre></div>
<pre><code>##  [1] "name"       "height"     "mass"       "hair_color" "skin_color"
##  [6] "eye_color"  "birth_year" "sex"        "gender"     "homeworld" 
## [11] "species"    "films"      "vehicles"   "starships"</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">homeworld</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(mean_height = <span class="fu"><a href="#base/mean.html">mean</a></span>(<span class="kw">height</span>, na.rm = <span class="fl">TRUE</span>),
            mean_mass = <span class="fu"><a href="#base/mean.html">mean</a></span>(<span class="kw">mass</span>, na.rm = <span class="fl">TRUE</span>),
            count = <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span>()) </pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 49 x 4
##    homeworld      mean_height mean_mass count
##    &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
##  1 Alderaan              176.      64       3
##  2 Aleen Minor            79       15       1
##  3 Bespin                175       79       1
##  4 Bestine IV            180      110       1
##  5 Cato Neimoidia        191       90       1
##  6 Cerea                 198       82       1
##  7 Champala              196      NaN       1
##  8 Chandrila             150      NaN       1
##  9 Concord Dawn          183       79       1
## 10 Corellia              175       78.5     2
## # … with 39 more rows</code></pre>
<p>The above is colloquially called “an interactive script.” The name comes from the fact that we directly use names of variables (such as “<code>homeworld</code>”, which would only be known from looking at the data directly) in our analysis code. Only somebody interacting with the data could write such a script (hence the name).</p>
<p>It has long been considered a point of discomfort to convert such an interactive <code>dplyr</code> pipeline into a re-usable script or function. That is a script or function that specifies column names in some <a href="https://win-vector.com/2017/04/21/programming-over-r/">parametric</a> or re-usable fashion. Roughly it means the names of the data columns are not yet known when we are writing the code (and this is what makes the code re-usable).</p>
<p>This inessential (or conquerable) difficulty is largely a due to the strong preference for <a href="http://adv-r.had.co.nz/Computing-on-the-language.html">non-standard evaluation interfaces</a> (that is interfaces that capture and inspect un-evaluated expressions from their calling interface) in the design <code>dplyr</code>. The common tooling to work around <code>dplyr</code>’s non-standard interfaces is a system called alternately <code>rlang</code> (a name which is perhaps a bit overly ambitious as <code>rlang</code> is not the <code>R</code> language) or tidyeval (a name which is perhaps a bit derogatory, incorrectly labeling <code>R</code> itself as the “non-tidy” dialect relative to tidyeval). We, on the other hand, recommend using either the superior tooling offered by <a href="https://winvector.github.io/wrapr/reference/let.html"><code>wrapr::let()</code></a> (which actual pre-dates <code>rlang</code> and can be used with any package, not just those that are designed around it) or to avoid non-standard interface foibles by using a standard evaluation adapter for <code>dplyr</code> called <a href="https://CRAN.R-project.org/package=seplyr"><code>seplyr</code></a> (which we will discuss here).</p>
<p>Our contention is a dialect (or adaption) of <code>dplyr</code> itself (which we call <code>seplyr</code> for “standard evaluation plyr”) that emphasizes standard (or value carrying) interfaces is easy to use and does not require the complexities of <code>rlang</code> (as <code>seplyr</code> fails to introduce the difficulty <code>rlang</code> is designed to feast on).</p>
</div>
<div id="seplyr" class="section level2">
<h2 class="hasAnchor">
<a href="#seplyr" class="anchor"></a><code>seplyr</code>
</h2>
<p><code>seplyr</code> is a <code>dplyr</code> adapter layer that prefers “slightly clunkier” standard interfaces (or <a href="https://en.wikipedia.org/wiki/Referential_transparency">referentially transparent</a> interfaces), which are actually very powerful and can be used to some advantage.</p>
<p>The above description and comparisons can come off as needlessly broad and painfully abstract. Things are much clearer if we move away from theory and return to our example.</p>
<p>Let’s translate the above example into a re-usable function in small (easy) stages. First translate the interactive script from <code>dplyr</code> notation into <code>seplyr</code> notation. This step is a pure <a href="https://en.wikipedia.org/wiki/Code_refactoring">re-factoring</a>, we are changing the code without changing its observable external behavior.</p>
<p>The translation is mechanical in that it is mostly using <code>seplyr</code> documentation as a lookup table. What you have to do is:</p>
<ul>
<li>Change <code>dplyr</code> verbs to their matching <code>seplyr</code> “<code>*_se()</code>” adapters.</li>
<li>Add quote marks around names and expressions.</li>
<li>Convert sequences of expressions (such as in the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>) to explicit vectors by adding the “<code><a href="#base/c.html">c()</a></code>” notation.</li>
<li>Replace “<code><a href="#base/assignOps.html">=</a></code>” in expressions with “<code>:=</code>”.</li>
</ul>
<p>Our converted code looks like the following.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="fu"><a href="#base/library.html">library</a></span>(<span class="st"><a href="https://github.com/WinVector/seplyr/">"seplyr"</a></span>)</pre></div>
<pre><code>## Loading required package: wrapr</code></pre>
<pre><code>## 
## Attaching package: 'wrapr'</code></pre>
<pre><code>## The following object is masked from 'package:dplyr':
## 
##     coalesce</code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="kw">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/group_by_se.html">group_by_se</a></span>(<span class="st">"homeworld"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/summarize_se.html">summarize_se</a></span>(<span class="fu"><a href="#base/c.html">c</a></span>(<span class="st">"mean_height"</span> <span class="op">:=</span> <span class="st">"mean(height, na.rm = TRUE)"</span>,
                 <span class="st">"mean_mass"</span> <span class="op">:=</span> <span class="st">"mean(mass, na.rm = TRUE)"</span>,
                 <span class="st">"count"</span> <span class="op">:=</span> <span class="st">"n()"</span>))</pre></div>
<pre><code>## Warning: The `add` argument of `group_by()` is deprecated as of dplyr 1.0.0.
## Please use the `.add` argument instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<pre><code>## # A tibble: 49 x 4
##    homeworld      mean_height mean_mass count
##    &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
##  1 Alderaan              176.      64       3
##  2 Aleen Minor            79       15       1
##  3 Bespin                175       79       1
##  4 Bestine IV            180      110       1
##  5 Cato Neimoidia        191       90       1
##  6 Cerea                 198       82       1
##  7 Champala              196      NaN       1
##  8 Chandrila             150      NaN       1
##  9 Concord Dawn          183       79       1
## 10 Corellia              175       78.5     2
## # … with 39 more rows</code></pre>
<p>This code works the same as the original <code>dplyr</code> code. Also the translation could be performed by following the small set of explicit re-coding rules that we gave above.</p>
<p>Obviously at this point all we have done is: worked to make the code a bit less pleasant looking. We have yet to see any benefit from this conversion (though we can turn this on its head and say all the original <code>dplyr</code> notation is saving us is from having to write a few quote marks).</p>
<p>The benefit is: this new code can <em>very easily</em> be parameterized and wrapped in a re-usable function. In fact it is now simpler to do than to describe.</p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="kw">grouped_mean</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">data</span>, 
                         <span class="kw">grouping_variables</span>, 
                         <span class="kw">value_variables</span>,
                         <span class="kw">count_name</span> = <span class="st">"count"</span>) {
  <span class="kw">result_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="#base/paste.html">paste0</a></span>(<span class="st">"mean_"</span>, 
                         <span class="kw">value_variables</span>)
  <span class="kw">expressions</span> <span class="op">&lt;-</span> <span class="fu"><a href="#base/paste.html">paste0</a></span>(<span class="st">"mean("</span>, 
                        <span class="kw">value_variables</span>, 
                        <span class="st">", na.rm = TRUE)"</span>)
  <span class="kw">calculation</span> <span class="op">&lt;-</span> <span class="kw">result_names</span> <span class="op">:=</span> <span class="kw">expressions</span>
  <span class="kw">data</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/group_by_se.html">group_by_se</a></span>(<span class="kw">grouping_variables</span>) <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/summarize_se.html">summarize_se</a></span>(<span class="fu"><a href="#base/c.html">c</a></span>(<span class="kw">calculation</span>,
                   <span class="kw">count_name</span> <span class="op">:=</span> <span class="st">"n()"</span>)) <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span>()
}

<span class="kw">starwars</span> <span class="op">%&gt;%</span> 
  <span class="fu">grouped_mean</span>(grouping_variables = <span class="fu"><a href="#base/c.html">c</a></span>(<span class="st">"eye_color"</span>, <span class="st">"skin_color"</span>),
               value_variables = <span class="fu"><a href="#base/c.html">c</a></span>(<span class="st">"mass"</span>, <span class="st">"birth_year"</span>))</pre></div>
<pre><code>## # A tibble: 53 x 5
##    eye_color skin_color       mean_mass mean_birth_year count
##    &lt;chr&gt;     &lt;chr&gt;                &lt;dbl&gt;           &lt;dbl&gt; &lt;int&gt;
##  1 black     green                 80.5            44       2
##  2 black     grey                  78.7           NaN       4
##  3 black     none                 NaN             NaN       1
##  4 black     orange                80              22       1
##  5 black     red, blue, white      57             NaN       1
##  6 black     white, blue          NaN             NaN       1
##  7 blue      blue                 NaN             NaN       1
##  8 blue      brown                136             NaN       1
##  9 blue      dark                  50             NaN       1
## 10 blue      fair                  90              62.6    10
## # … with 43 more rows</code></pre>
<p>We have translated our original interactive or ad-hoc calculation into a parameterized reusable function in two easy steps:</p>
<ul>
<li>Translate into  notation.</li>
<li>Replace values with variables.</li>
</ul>
<p>To be sure: there are some clunky details of using  to build up the expressions, but the conversion process is very regular and easy. In <code>seplyr</code> parametric programming is intentionally easy (just replace values with variables).</p>
</div>
<div id="rlangtidyeval" class="section level2">
<h2 class="hasAnchor">
<a href="#rlangtidyeval" class="anchor"></a><code>rlang</code>/tidyeval</h2>
<p>The above may all seem academic as “<code>dplyr</code> supplies its own parametric abstraction layer: <code>rlang</code>/tidyeval.” However, in our opinion <code>rlang</code> abstraction is irregular and full of corner cases (even for simple column names). When you are programming of <code>rlang</code> you are programming over a language that is not quite <code>R</code>, and a language that is not in fact superior to <code>R</code>. Take for example the following example from the <a href="https://blog.rstudio.com/2017/06/13/dplyr-0-7-0/"><code>dplyr</code> <code>0.7.0</code> announcement</a>:</p>
<p><img src="dplyr_rlan_example.png"></p>
<p>The above code appears to work, unless you take the extra steps of actually running it and examining the results.</p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="fu"><a href="#utils/packageDescription.html">packageVersion</a></span>(<span class="st">"dplyr"</span>)</pre></div>
<pre><code>## [1] '1.0.1'</code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="fu"><a href="#utils/packageDescription.html">packageVersion</a></span>(<span class="st">"rlang"</span>)</pre></div>
<pre><code>## [1] '0.4.7'</code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="fu"><a href="#utils/packageDescription.html">packageVersion</a></span>(<span class="st">"tidyselect"</span>)</pre></div>
<pre><code>## [1] '1.1.0'</code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit">
<span class="kw">my_var</span> <span class="op">&lt;-</span> <span class="st">"homeworld"</span>

<span class="kw">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">.data</span>[[<span class="kw">my_var</span>]]) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_at</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw">height</span><span class="op">:</span><span class="kw">mass</span>), <span class="kw">mean</span>, na.rm = <span class="fl">TRUE</span>)</pre></div>
<pre><code>## # A tibble: 49 x 3
##    homeworld      height  mass
##    &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt;
##  1 Alderaan         176.  64  
##  2 Aleen Minor       79   15  
##  3 Bespin           175   79  
##  4 Bestine IV       180  110  
##  5 Cato Neimoidia   191   90  
##  6 Cerea            198   82  
##  7 Champala         196  NaN  
##  8 Chandrila        150  NaN  
##  9 Concord Dawn     183   79  
## 10 Corellia         175   78.5
## # … with 39 more rows</code></pre>
<p>Notice the created grouping column is called “<code>my_var</code>”, and <em>not</em> “<code>homeworld</code>”. This may <em>seem</em> like a small thing, but it will cause any downstream processing to fail. One can try variations and get many different results, some of which are correct and some of which are not.</p>
<div class="sourceCode" id="cb27"><pre class="downlit">
<span class="co"># wrong</span>
<span class="kw">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="op">!</span><span class="op">!</span><span class="kw">my_var</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_at</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw">height</span><span class="op">:</span><span class="kw">mass</span>), <span class="kw">mean</span>, na.rm = <span class="fl">TRUE</span>)</pre></div>
<pre><code>## # A tibble: 1 x 3
##   `"homeworld"` height  mass
##   &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt;
## 1 homeworld       174.  97.3</code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit">
<span class="co"># correct, or at least appears to work</span>
<span class="kw">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="op">!</span><span class="op">!</span><span class="kw">rlang</span>::<span class="fu"><a href="https://rlang.r-lib.org/reference/sym.html">sym</a></span>(<span class="kw">my_var</span>)) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_at</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw">height</span><span class="op">:</span><span class="kw">mass</span>), <span class="kw">mean</span>, na.rm = <span class="fl">TRUE</span>)</pre></div>
<pre><code>## # A tibble: 49 x 3
##    homeworld      height  mass
##    &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt;
##  1 Alderaan         176.  64  
##  2 Aleen Minor       79   15  
##  3 Bespin           175   79  
##  4 Bestine IV       180  110  
##  5 Cato Neimoidia   191   90  
##  6 Cerea            198   82  
##  7 Champala         196  NaN  
##  8 Chandrila        150  NaN  
##  9 Concord Dawn     183   79  
## 10 Corellia         175   78.5
## # … with 39 more rows</code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit">
<span class="co"># correct, or at least appears to work</span>
<span class="kw">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">.data</span>[[<span class="op">!</span><span class="op">!</span><span class="kw">my_var</span>]]) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_at</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw">height</span><span class="op">:</span><span class="kw">mass</span>), <span class="kw">mean</span>, na.rm = <span class="fl">TRUE</span>)</pre></div>
<pre><code>## # A tibble: 49 x 3
##    homeworld      height  mass
##    &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt;
##  1 Alderaan         176.  64  
##  2 Aleen Minor       79   15  
##  3 Bespin           175   79  
##  4 Bestine IV       180  110  
##  5 Cato Neimoidia   191   90  
##  6 Cerea            198   82  
##  7 Champala         196  NaN  
##  8 Chandrila        150  NaN  
##  9 Concord Dawn     183   79  
## 10 Corellia         175   78.5
## # … with 39 more rows</code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit">
<span class="co"># errors-out</span>
<span class="kw">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">.data</span>[[<span class="op">!</span><span class="op">!</span><span class="kw">rlang</span>::<span class="fu"><a href="https://rlang.r-lib.org/reference/sym.html">sym</a></span>(<span class="kw">my_var</span>)]]) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_at</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw">height</span><span class="op">:</span><span class="kw">mass</span>), <span class="kw">mean</span>, na.rm = <span class="fl">TRUE</span>)</pre></div>
<pre><code>## # A tibble: 49 x 3
##    homeworld      height  mass
##    &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt;
##  1 Alderaan         176.  64  
##  2 Aleen Minor       79   15  
##  3 Bespin           175   79  
##  4 Bestine IV       180  110  
##  5 Cato Neimoidia   191   90  
##  6 Cerea            198   82  
##  7 Champala         196  NaN  
##  8 Chandrila        150  NaN  
##  9 Concord Dawn     183   79  
## 10 Corellia         175   78.5
## # … with 39 more rows</code></pre>
<p>Notice above in some places strings are required and in others names or symbols are required. In some contexts one may substitute for the other, and in some contexts they can not. In some situations “<code>!!</code>” must be used, and in others it must not be used. In some situations “<code><a href="https://rlang.r-lib.org/reference/sym.html">rlang::sym()</a></code>” must be used, and in some situations it must not be used. In some situations errors are signaled, and in others a bad result is quietly returned.</p>
<p>The details above are <a href="https://dplyr.tidyverse.org/articles/programming.html">possibly teachable</a> (in the sense one can rote memorize them, once APIs stabilize and stop changing), but they are not friendly to exploration or discoverable. There are a needlessly large number of moving pieces (strings, names, symbols, quoting, quosures, de-quoting, “data pronouns”, select semantics, non-select semantics, <code><a href="#base/assignOps.html">=</a></code> versus <code>:=</code>, and so on) and one is expected to know which combinations of these items work together in which context.</p>
<p>For a further example consider the following.</p>
<div class="sourceCode" id="cb35"><pre class="downlit">
<span class="co"># correct, or at least appears to work</span>
<span class="kw">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="kw">my_var</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="#utils/head.html">head</a></span>(n=<span class="fl">2</span>)</pre></div>
<pre><code>## Note: Using an external vector in selections is ambiguous.
## ℹ Use `all_of(my_var)` instead of `my_var` to silence this message.
## ℹ See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.
## This message is displayed once per session.</code></pre>
<pre><code>## # A tibble: 2 x 1
##   homeworld
##   &lt;chr&gt;    
## 1 Tatooine 
## 2 Tatooine</code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit">
<span class="co"># errors-out</span>
<span class="kw">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">my_var</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="#utils/head.html">head</a></span>(n=<span class="fl">2</span>)</pre></div>
<pre><code>## Error: Must group by variables found in `.data`.
## * Column `my_var` is not found.</code></pre>
<p>The “use the value unless the variable name is a column” semantics of select can make code hard to read and potentially unsafe.<br>
The point is the user does not know what column a <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> actually chooses unless that know all of:</p>
<ul>
<li>The name of the variable being used (in this case “<code>my_var</code>”).</li>
<li>The value in the variable.</li>
<li>If the <code>data.frame</code> does or does not have a column matching the variable name.</li>
</ul>
<p>Column-name coincidences are actually likely in re-usable code. Often when generalizing a sequence of operations, one often chooses an existing column name as the name of a column control variable.</p>
<p>Let’s look at examples.</p>
<div class="sourceCode" id="cb40"><pre class="downlit">
<span class="kw">my_var</span> <span class="op">&lt;-</span> <span class="st">"homeworld"</span>
<span class="co"># selects height column</span>
<span class="kw">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="kw">my_var</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="#utils/head.html">head</a></span>(n=<span class="fl">2</span>)</pre></div>
<pre><code>## # A tibble: 2 x 1
##   homeworld
##   &lt;chr&gt;    
## 1 Tatooine 
## 2 Tatooine</code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit">
<span class="co"># perhaps different data with an extra column</span>
<span class="kw">starwars_plus</span> <span class="op">&lt;-</span> <span class="kw">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(my_var = <span class="fu"><a href="#base/seq.html">seq_len</a></span>(<span class="fu"><a href="#base/nrow.html">nrow</a></span>(<span class="kw">starwars</span>)))

<span class="co"># same code now selects my_var column</span>
<span class="kw">starwars_plus</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="kw">my_var</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="#utils/head.html">head</a></span>(n=<span class="fl">2</span>)</pre></div>
<pre><code>## # A tibble: 2 x 1
##   my_var
##    &lt;int&gt;
## 1      1
## 2      2</code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit">
<span class="co"># original official example code now errors-out</span>
<span class="kw">starwars_plus</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">.data</span>[[<span class="kw">my_var</span>]]) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_at</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw">height</span><span class="op">:</span><span class="kw">mass</span>), <span class="kw">mean</span>, na.rm = <span class="fl">TRUE</span>)</pre></div>
<pre><code>## # A tibble: 49 x 3
##    homeworld      height  mass
##    &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt;
##  1 Alderaan         176.  64  
##  2 Aleen Minor       79   15  
##  3 Bespin           175   79  
##  4 Bestine IV       180  110  
##  5 Cato Neimoidia   191   90  
##  6 Cerea            198   82  
##  7 Champala         196  NaN  
##  8 Chandrila        150  NaN  
##  9 Concord Dawn     183   79  
## 10 Corellia         175   78.5
## # … with 39 more rows</code></pre>
<p>The above <em>might</em> be acceptable in interactive work, if we assume the user knows the names of all of the columns in the <code>data.frame</code> and therefore can be held responsible for avoiding column name to variable coincidences. Or more realistically: the user is working interactively in the sense they are there to alter and re-run the code if they happen to notice the failure. However, this is not a safe state of affairs in re-usable functions or packages: which should work even if their are naming coincidences in thought to be irrelevant extra columns.</p>
<p><code>rlang</code> does have methods to write unambiguous code such as in:</p>
<div class="sourceCode" id="cb46"><pre class="downlit">
<span class="kw">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">!</span><span class="op">!</span><span class="kw">my_var</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="#utils/head.html">head</a></span>(n=<span class="fl">2</span>)</pre></div>
<pre><code>## # A tibble: 2 x 1
##   homeworld
##   &lt;chr&gt;    
## 1 Tatooine 
## 2 Tatooine</code></pre>
<p>However, because the <code>dplyr</code> interface does not insist on the “<code>!!</code>” notation, the “<code>!!</code>” notation will not always be remembered. <code>rlang</code>/tidyeval interfaces tend to be complex and irregular.</p>
<p>The <code><a href="../reference/select_se.html">seplyr::select_se()</a></code> interface is intentionally simple and regular: it always looks for columns using the strings (not variable names) given.</p>
<div class="sourceCode" id="cb48"><pre class="downlit">
<span class="fu"><a href="#base/print.html">print</a></span>(<span class="kw">my_var</span>)</pre></div>
<pre><code>## [1] "homeworld"</code></pre>
<div class="sourceCode" id="cb50"><pre class="downlit">
<span class="co"># selects homeworld column (the value specified my_var) independent of</span>
<span class="co"># any coincidence between variable name and column names.</span>
<span class="kw">starwars_plus</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/select_se.html">select_se</a></span>(<span class="kw">my_var</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="#utils/head.html">head</a></span>(n=<span class="fl">2</span>)</pre></div>
<pre><code>## # A tibble: 2 x 1
##   homeworld
##   &lt;chr&gt;    
## 1 Tatooine 
## 2 Tatooine</code></pre>
<p>We have found when a programing notation is irregular it discourages exploration and leads to learned helplessness (rote appeals to authority and manuals instead of rapid acquisition of patterns and skills).</p>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>The <code>seplyr</code> methodology is simple, easy to teach, and powerful.</p>
<p>The methodologies we discussed differ in philosophy.</p>
<ul>
<li>
<code>rlang</code>/tidyeval is often used to build new non-standard interfaces on top of existing non-standard interfaces. This is needed because non-standard interfaces do not naturally compose. The tidy/non-tidy analogy is: it works around a mess by introducing a new mess.</li>
<li>
<code><a href="https://winvector.github.io/wrapr//reference/let.html">wrapr::let()</a></code> converts non-standard interfaces into standard <a href="https://en.wikipedia.org/wiki/Referential_transparency">referentially transparent</a> or value-oriented interfaces. It tries to help clean up messes.</li>
<li>
<code>seplyr</code> is a demonstration of a possible variation of <code>dplyr</code> where more of the interfaces expect values. It tries to cut down on the initial mess, which in turn cuts down on the need for tools and training in dealing with messes.</li>
</ul>
<p>The <code>seplyr</code> package contains a number of worked examples both in <code>help()</code> and <a href="https://winvector.github.io/seplyr/articles/seplyr.html"><code>vignette(package='seplyr')</code></a> documentation.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by John Mount.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
