<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>String Algebra • seplyr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">seplyr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/seplyr.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mutate.html">mutate</a>
    </li>
    <li>
      <a href="../articles/named_map_builder.html">Named Map Builder</a>
    </li>
    <li>
      <a href="../articles/rename_se.html">rename_se</a>
    </li>
    <li>
      <a href="../articles/StringAlgebra.html">String Algebra</a>
    </li>
    <li>
      <a href="../articles/using_seplyr.html">Using seplyr to Program Over dplyr</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://www.win-vector.com/">Sponsor: Win-Vector LLC</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>String Algebra</h1>
                        <h4 class="author">John Mount</h4>
            
            <h4 class="date">2017-10-04</h4>
          </div>

    
    
<div class="contents">
<p><a href="https://winvector.github.io/seplyr/index.html"><code>seplyr</code></a> supplies the function <code><a href="http://www.rdocumentation.org/packages/seplyr/topics/expand_expr">seplyr::expand_expr()</a></code> which implements what we call “the string algebra” or string expression interpolation. The function takes an expression of mixed terms, including: variables referring to names, quoted strings, and general expression terms. It then “de-quotes” all of the variables referring to quoted strings and “dereferences” variables thought to be referring to names. The entire expression is then returned as a single string.</p>
<p>This is easiest to see with an example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"seplyr"</span>)</code></pre></div>
<pre><code>## Loading required package: wrapr</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ratio &lt;-<span class="st"> </span><span class="dv">2</span>
compCol1 &lt;-<span class="st"> "Sepal.Width"</span>
expr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/expand_expr.html">expand_expr</a></span>(<span class="st">"Sepal.Length"</span> &gt;=<span class="st"> </span>ratio *<span class="st"> </span>compCol1)
<span class="kw">print</span>(expr)</code></pre></div>
<pre><code>## [1] "Sepal.Length &gt;= ratio * Sepal.Width"</code></pre>
<p><code>expand_expr</code> works by capturing the user supplied expression unevaluated, performing some transformations, and returning the entire expression as a single quoted string (essentially returning new source code).</p>
<p>Notice in the above one layer of quoting was removed from <code>"Sepal.Length"</code> and the name referred to by “<code>compCol1</code>” was substituted into the expression. “<code>ratio</code>” was left alone as it was not referring to a string (and hence can not be a name; unbound or free variables are also left alone). So we see that the substitution performed does depend on what values are present in the environment.</p>
<p>If you want to be stricter in your specification, you could add quotes around any symbol you do not want de-referenced. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/expand_expr.html">expand_expr</a></span>(<span class="st">"Sepal.Length"</span> &gt;=<span class="st"> "ratio"</span> *<span class="st"> </span>compCol1)</code></pre></div>
<pre><code>## [1] "Sepal.Length &gt;= ratio * Sepal.Width"</code></pre>
<p>After the substitution the returned quoted expression is exactly in the form <code>seplyr</code> expects. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">resCol1 &lt;-<span class="st"> "Sepal_Long"</span>

datasets::iris %.&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/mutate_se.html">mutate_se</a></span>(., 
            resCol1 :<span class="er">=</span><span class="st"> </span>expr) %.&gt;%
<span class="st">  </span><span class="kw">head</span>(.)</code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species Sepal_Long
## 1          5.1         3.5          1.4         0.2  setosa      FALSE
## 2          4.9         3.0          1.4         0.2  setosa      FALSE
## 3          4.7         3.2          1.3         0.2  setosa      FALSE
## 4          4.6         3.1          1.5         0.2  setosa      FALSE
## 5          5.0         3.6          1.4         0.2  setosa      FALSE
## 6          5.4         3.9          1.7         0.4  setosa      FALSE</code></pre>
<p>Details on <a href="https://winvector.github.io/wrapr/reference/grapes-.-greater-than-grapes.html"><code>%.&gt;%</code></a> (dot pipe) and <a href="https://winvector.github.io/wrapr/reference/named_map_builder.html"><code>:=</code></a> (named map builder) can be found <a href="https://winvector.github.io/wrapr/articles/dot_pipe.html">here</a> and <a href="https://winvector.github.io/seplyr/articles/named_map_builder.html">here</a> respectively. The idea is: <code><a href="http://www.rdocumentation.org/packages/seplyr/topics/mutate_se">seplyr::mutate_se(., "Sepal_Long" := "Sepal.Length &gt;= ratio * Sepal.Width")</a></code> should be equilant to <code><a href="http://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate(., Sepal_Long = Sepal.Length &gt;= ratio * Sepal.Width)</a></code>.</p>
<p><code>seplyr</code> also provides an number of <code>seplyr::*_nse()</code> convenience forms wrapping all of these steps into one operation. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">datasets::iris %.&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/mutate_nse.html">mutate_nse</a></span>(., 
             resCol1 :<span class="er">=</span><span class="st"> "Sepal.Length"</span> &gt;=<span class="st"> </span>ratio *<span class="st"> </span>compCol1) %.&gt;%
<span class="st">  </span><span class="kw">head</span>(.)</code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species Sepal_Long
## 1          5.1         3.5          1.4         0.2  setosa      FALSE
## 2          4.9         3.0          1.4         0.2  setosa      FALSE
## 3          4.7         3.2          1.3         0.2  setosa      FALSE
## 4          4.6         3.1          1.5         0.2  setosa      FALSE
## 5          5.0         3.6          1.4         0.2  setosa      FALSE
## 6          5.4         3.9          1.7         0.4  setosa      FALSE</code></pre>
<p>To use string literals you merely need one extra layer of quoting:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"is_setosa"</span> :<span class="er">=</span><span class="st"> </span><span class="kw"><a href="../reference/expand_expr.html">expand_expr</a></span>(Species ==<span class="st"> "'setosa'"</span>)</code></pre></div>
<pre><code>##               is_setosa 
## "Species == \"setosa\""</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">datasets::iris %.&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/transmute_nse.html">transmute_nse</a></span>(., 
             <span class="st">"is_setosa"</span> :<span class="er">=</span><span class="st"> </span>Species ==<span class="st"> "'setosa'"</span>) %.&gt;%
<span class="st">  </span><span class="kw">summary</span>(.)</code></pre></div>
<pre><code>##  is_setosa      
##  Mode :logical  
##  FALSE:100      
##  TRUE :50</code></pre>
<p>The purpose of all of the above is to mix names that are known while we are writing the code (these are quoted) with names that may not be known until later (i.e., column names supplied as parameters). This allows the easy creation of useful generic functions such as:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">countMatches &lt;-<span class="st"> </span>function(data, columnName, targetValue) {
  <span class="co"># extra quotes to say we are interested in value, not de-reference</span>
  targetSym &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">'"'</span>, targetValue, <span class="st">'"'</span>) 
  data %.&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/transmute_nse.html">transmute_nse</a></span>(., <span class="st">"match"</span> :<span class="er">=</span><span class="st"> </span>columnName ==<span class="st"> </span>targetSym) %.&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/group_by_se.html">group_by_se</a></span>(., <span class="st">"match"</span>) %.&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/summarize_se.html">summarize_se</a></span>(., <span class="st">"count"</span> :<span class="er">=</span><span class="st"> "n()"</span>)
}

<span class="kw">countMatches</span>(datasets::iris, <span class="st">"Species"</span>, <span class="st">"setosa"</span>)</code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   match count
##   &lt;lgl&gt; &lt;int&gt;
## 1 FALSE   100
## 2  TRUE    50</code></pre>
<p>The purpose of the <code>seplyr</code> string system is to pull off quotes and de-reference indirect variables. So, you need to remember to add enough extra quotation marks to prevent this where you do not want it.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by John Mount.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
